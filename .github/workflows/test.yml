name: Test

on:
  push:

jobs:
  download:
    name: Download lib
    runs-on: ubuntu-latest
    steps: 
      - uses: actions/checkout@v2
      - run: make lib.download
      - name: Upload libwebrtc-sys
        uses: actions/upload-artifact@v2
        with:
          name: libwebrtc-sys
          path: libwebrtc-sys/

  test:
    name: Rust tests
    needs:
     - download
    runs-on: windows-latest
    steps:
      - run: choco install make
      - run: make lib.download
      - uses: actions/checkout@v2
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - run: cd libwebrtc-sys && cargo test --test integration_test
  
